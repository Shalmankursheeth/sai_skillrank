import { useState } from "react";
import { uploadResume } from "../api";
import Spinner from "../components/Spinner";
export default function ResumeUpload(){
  const [file,setFile]=useState(null); const [name,setName]=useState(""); const [email,setEmail]=useState(""); const [runExtract,setRunExtract]=useState(false); const [loading,setLoading]=useState(false); const [result,setResult]=useState(null); const [error,setError]=useState(null);
  async function handleSubmit(e){ e.preventDefault(); setError(null); if(!file){ setError("Choose a PDF"); return; } if(!file.type.includes("pdf")){ setError("Only PDF allowed"); return; } setLoading(true); try{ const res = await uploadResume(file,name,email,runExtract); setResult(res); }catch(err){ setError("Upload failed: "+String(err)); setResult(null); } finally{ setLoading(false); } }
  return (<div className="container mx-auto p-4 max-w-3xl"><div className="p-6 bg-white border rounded shadow-sm"><h1 className="text-2xl font-semibold mb-3">Upload Resume (PDF)</h1><form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-sm">PDF File</label><input type="file" accept="application/pdf" onChange={(e)=>setFile(e.target.files?.[0]??null)} className="mt-2" /></div><div className="grid grid-cols-1 md:grid-cols-2 gap-3"><input value={name} onChange={(e)=>setName(e.target.value)} placeholder="Name (optional)" className="p-2 border rounded" /><input value={email} onChange={(e)=>setEmail(e.target.value)} placeholder="Email (optional)" className="p-2 border rounded" /></div><label className="inline-flex items-center gap-2"><input type="checkbox" checked={runExtract} onChange={(e)=>setRunExtract(e.target.checked)} /><span className="text-sm">Run extraction immediately</span></label><div><button disabled={loading} className="inline-flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded">{loading ? <Spinner/> : null}{loading ? "Uploading..." : "Upload Resume"}</button></div>{error && <div className="text-sm text-red-600">{error}</div>}</form>{result && (<div className="mt-6 bg-gray-50 border p-4 rounded"><h2 className="font-semibold">Upload Result</h2><div className="mt-2 text-sm"><strong>ID:</strong> {result.id}</div><div className="mt-2"><strong>Preview:</strong></div><pre className="text-xs whitespace-pre-wrap mt-2 bg-white p-2 rounded border">{result.resume_text_snippet ?? result.resume_text_preview ?? result.resume_text}</pre></div>)}</div></div>);
}
